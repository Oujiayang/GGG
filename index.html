<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>GPS 即時地圖</title>
  <style>
    #map {
      height: 100vh;
      width: 100%;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script>
    let map, marker;
    const gps2ipURL = "http://192.168.1.1:11123"; // 改成 GPS2IP 提供的 IP 與 port

    async function fetchLocation() {
      try {
        const response = await fetch(gps2ipURL);
        const text = await response.text();

        // 解析 GPS2IP 傳回的格式，例如 "Latitude: 25.033, Longitude: 121.565"
        const match = text.match(/Latitude:\s*(-?\d+\.\d+),\s*Longitude:\s*(-?\d+\.\d+)/);
        if (!match) return;

        const lat = parseFloat(match[1]);
        const lng = parseFloat(match[2]);
        const pos = { lat, lng };

        if (!map) {
          map = new google.maps.Map(document.getElementById("map"), {
            zoom: 15,
            center: pos
          });
          marker = new google.maps.Marker({
            position: pos,
            map: map
          });
        } else {
          map.setCenter(pos);
          marker.setPosition(pos);
        }
      } catch (err) {
        console.error("錯誤：無法取得位置資料", err);
      }
    }

    // 每秒更新一次位置
    setInterval(fetchLocation, 1000);
  </script>

  <!-- Google Maps API -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAB2eC2UMVbzmgHSCce_C_34zKH0KG_Uxw"></script>
</body>
</html>
